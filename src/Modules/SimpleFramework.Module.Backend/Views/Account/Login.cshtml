@model LoginViewModel
@inject SignInManager<UserEntity> SignInManager

@{
    Layout = "~/Views/Shared/_Root.cshtml";
    ViewData["Title"] = Localizer["Log in"];
}

@*<h2>@ViewData["Title"].</h2>
    <div class="row">
        <div class="col-md-8">
            <section>
                <form asp-controller="Account" asp-action="Login" asp-route-returnurl="@ViewData["ReturnUrl"]" method="post" class="form-horizontal">
                    <h4>@Localizer["Use a local account to log in."]</h4>
                    <hr />
                    <div asp-validation-summary="All" class="text-danger"></div>
                    <div class="form-group">
                        <label asp-for="Email" class="col-md-4 control-label">@Localizer["Email"]</label>
                        <div class="col-md-8">
                            <input asp-for="Email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label asp-for="Password" class="col-md-4 control-label">@Localizer["Password"]</label>
                        <div class="col-md-8">
                            <input asp-for="Password" class="form-control" />
                            <span asp-validation-for="Password" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-4 col-md-8">
                            <div class="checkbox">
                                <label asp-for="RememberMe">
                                    <input asp-for="RememberMe" />
                                    @Localizer["Remember me?"]
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-4 col-md-8">
                            <button type="submit" class="btn btn-default">@Localizer["Log in"]</button>
                        </div>
                    </div>
                    <p>
                        <a asp-action="Register" asp-route-returnurl="@ViewData["ReturnUrl"]">@Localizer["Register as a new user?"]</a>
                    </p>
                    <p>
                        <a asp-action="ForgotPassword">@Localizer["Forgot your password?"]</a>
                    </p>
                </form>
            </section>
        </div>

</div*@>

<div id="content">
    <div id="logo">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="60.185px" height="60.063px" viewbox="0 0 60.185 60.063" enable-background="new 0 0 60.185 60.063" xml:space="preserve"><path class="rock-logo" fill="#FFFFFF" d="M57.705 60.063L41.387 40.936c0 0 11.83-0.026 11.928-0.028c1.313 0.1 2.654-0.351 3.736-1.259 c2.33-1.948 2.643-5.414 0.693-7.752L32.396 2.151c-0.242-0.319-0.516-0.62-0.836-0.891c-0.039-0.029-0.084-0.051-0.121-0.082 c-0.012-0.01-0.027-0.018-0.039-0.025c-0.279-0.216-0.566-0.405-0.867-0.563c-0.018-0.009-0.039-0.014-0.059-0.021 c-0.301-0.151-0.609-0.276-0.922-0.366c-0.057-0.013-0.119-0.025-0.178-0.039c-0.277-0.063-0.557-0.129-0.84-0.15 c-0.172-0.021-0.346-0.008-0.516-0.008c-0.172 0-0.34-0.014-0.514 0.008c-0.281 0.021-0.559 0.087-0.84 0.1 c-0.059 0.014-0.115 0.026-0.174 0.039c-0.318 0.09-0.625 0.215-0.924 0.366c-0.021 0.009-0.039 0.014-0.057 0 c-0.305 0.156-0.598 0.347-0.869 0.563c-0.018 0.009-0.025 0.017-0.037 0.025c-0.039 0.031-0.084 0.053-0.123 0.1 c-0.32 0.271-0.594 0.57-0.84 0.885L0 29.86h14.461l13.557-15.891l13.604 15.967l-12.104 0.008c-0.045 0-0.088 0.013-0.133 0 c-0.287 0-0.578 0.026-0.865 0.071c-0.082 0.017-0.166 0.035-0.244 0.054c-0.26 0.053-0.52 0.132-0.775 0.2 c-0.094 0.034-0.182 0.072-0.266 0.117c-0.232 0.098-0.455 0.213-0.672 0.352c-0.096 0.062-0.193 0.131-0.285 0.2 c-0.117 0.081-0.238 0.143-0.346 0.229c-0.076 0.067-0.137 0.147-0.211 0.221c-0.088 0.082-0.174 0.172-0.258 0.3 c-0.166 0.171-0.318 0.351-0.453 0.531c-0.068 0.105-0.131 0.205-0.195 0.308c-0.127 0.198-0.236 0.396-0.332 0.6 c-0.059 0.126-0.107 0.255-0.156 0.384c-0.072 0.199-0.145 0.398-0.191 0.605c-0.037 0.145-0.063 0.301-0.084 0.5 c-0.035 0.202-0.059 0.403-0.07 0.606c-0.006 0.074-0.023 0.137-0.023 0.209c0 0.1 0 0.2 0 0.3 c0.012 0.2 0 0.4 0.1 0.557c0.025 0.2 0.1 0.4 0.1 0.555c0.039 0.2 0.1 0.3 0.1 0.5 c0.072 0.2 0.2 0.4 0.2 0.588c0.061 0.1 0.1 0.2 0.2 0.35c0.123 0.2 0.3 0.4 0.4 0.6 c0.045 0.1 0.1 0.1 0.1 0.168l18.004 21.104h14.459V60.063z"></svg>
    </div>
    <div id="content-box" class="clearfix">
        <div id="zone-main" class="zone-instance">
            <div class="zone-content">
                <div data-zone-location="Page" class="block-instance login">
                    <div class="block-content">
                        <form asp-controller="Account" asp-action="Login" asp-route-returnurl="@ViewData["ReturnUrl"]" method="post" class="form-horizontal">
                            <fieldset>
                                <legend>Login</legend>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div   class="login_tips alert alert-danger" style="display:none">
                                        </div>
                                        <div asp-validation-summary="All" class="text-danger"></div>
                                        <div class="form-group rock-text-box">
                                            <label class="control-label" asp-for="Email">@Localizer["Email"]</label>
                                            <div class="control-wrapper">
                                                <input asp-for="Email" class="form-control">
                                            </div>
                                            <span class="validation-error help-inline" style="display:none">Username is Required.</span>
                                        </div>
                                        <div class="form-group rock-text-box">
                                            <label class="control-label" asp-for="Password">@Localizer["Password"]</label>
                                            <div class="control-wrapper">
                                                <input type="hidden" name="tbPassword_dvrm" id="tbPassword_dvrm" value="True">
                                                <input asp-for="Password" class="form-control" autocomplete="off" value="">
                                            </div>
                                            <span class="validation-error help-inline" style="display:none">Password is Required.</span>
                                        </div>
                                        <div class="checkbox">
                                            <label><input asp-for="RememberMe">@Localizer["Remember me?"]</label>
                                        </div>
                                        <input type="submit" value="@Localizer["Log in"]" id="btnlogin" class="btn btn-primary">
                                        <input type="submit" value="@Localizer["Forgot your password?"]" id="btnHelp" class="btn btn-link">
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
                <div data-zone-location="Page" class="block-instance html-content">
                    <div class="block-content">
                            <div class="alert alert-info margin-t-lg">
                                <strong>Demo Account</strong> To login as a demo administrator use the username 'admin' with the password of 'admin'.
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    //回车键
    document.onkeydown = function (e) {
        if (!e) e = window.event;
        if ((e.keyCode || e.which) == 13) {
            var btlogin = document.getElementById("btnlogin");
            btnlogin.click();
        }
    }
    // add quick fade-in effect to the page
    $(document).ready(function () {
        $("#content").sfFadeIn();
        //错误提示
        if (top.$.cookie('learun_login_error') != null) {
            switch (top.$.cookie('learun_login_error')) {
                case "Overdue":
                    formMessage('登录已超时,请重新登录');
                    break;
                case "OnLine":
                    formMessage('您的帐号已在其它地方登录,请重新登录');
                    break;
                case "-1":
                    formMessage('未知错误,请重新登录');
                    break;
                default:
                    break;
            }
            top.$.cookie('learun_login_error', '', { path: "/", expires: -1 });
        }
        //是否自动登录
        if (top.$.cookie('learn_autologin') == 1) {
            $("#autologin").attr("checked", 'true');
            $("#Email").val(top.$.cookie('learn_username'));
            $("#Password").val(top.$.cookie('learn_password'));
            CheckLogin(1);
        }
        //设置下次自动登录
        $("#RememberMe").click(function () {
            if (!$(this).attr('checked')) {
                $(this).attr("checked", 'true');
                top.$.cookie('learn_autologin', 1, { path: "/", expires: 7 });
            } else {
                $(this).removeAttr("checked");
                top.$.cookie('learn_autologin', '', { path: "/", expires: -1 });
                top.$.cookie('learn_username', '', { path: "/", expires: -1 });
                top.$.cookie('learn_password', '', { path: "/", expires: -1 });
            }
        })
        //登录按钮事件
        $("#btnlogin").click(function () {
            var $username = $("#Email");
            var $password = $("#Password");
            //var $verifycode = $("#verifycode");
            if ($username.val() == "") {
                $username.focus();
                formMessage('请输入账户或手机号或邮箱。');
                return false;
            } else if ($password.val() == "") {
                $password.focus();
                formMessage('请输入密码。');
                return false;
            }
                // else if ($verifycode.val() == "") {
                //    $verifycode.focus();
                //    formMessage('请输入验证码。');
                //    return false;
                //}
            else {
                CheckLogin(0);
            }
        });
        //点击切换验证码
        $("#login_verifycode").click(function () {
            $("#verifycode").val('');
            $("#login_verifycode").attr("src", contentPath + "/Login/VerifyCode?time=" + Math.random());
        });  
    });
    //登录验证
    function CheckLogin(autologin) {
        $("#btnlogin").addClass('active').attr('disabled', 'disabled');
        $("#btnlogin").find('span').hide();

        var username = $.trim($("#Email").val());
        var password = $.trim($("#Password").val());
      //  var verifycode = $.trim($("#verifycode").val());
        if (top.$.cookie('learn_password') == "" || top.$.cookie('learn_password') == null) {
            password = $.md5(password);
        }
        $.ajax({
            url: contentPath + "/Login",
            data: { Email: $.trim(username), password: $.trim(password), verifycode: verifycode, rememberMe: autologin },
            type: "post",
            dataType: "json",
            success: function (data) {
                if (data.type == 1) {
                    if (top.$.cookie('learn_autologin') == 1) {
                        top.$.cookie('learn_username', $.trim(username), { path: "/", expires: 7 });
                        top.$.cookie('learn_password', $.trim(password), { path: "/", expires: 7 });
                    }
                    window.location.href = contentPath + '/Home/AdminDefault';
                } else {
                    if (data.message.length >= 30) {
                        SF.dialogs.alert(data.message)
                    } else {
                        formMessage(data.message);
                    }
                    $("#btnlogin").removeClass('active').removeAttr('disabled');
                    $("#btnlogin").find('span').show();
                    $("#login_verifycode").trigger("click");
                }
            }
        });
    }
    //提示信息
    function formMessage(msg, type) {
        $('.login_tips').prepend(msg);
        $('.login_tips').addClass("alert-danger");
        if (type == 1) {
            $('.login_tips').removeClass("alert-success");
        }
        $('.login_tips').show();
    }
</script>

<div style="display:none">
    <input type="submit" name="rock-config-trigger" value="" id="rock-config-trigger" />
    <input type="hidden" name="rock-config-trigger-data" id="rock-config-trigger-data" />
</div>
